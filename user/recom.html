<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Running a chain with ReCom &mdash; GerryChain  documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Working with Partitions" href="partitions.html" />
    <link rel="prev" title="Getting started with GerryChain" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #0099cd" >
            <a href="../index.html" class="icon icon-home"> GerryChain
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Overview of the Chain</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Getting started with GerryChain</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running a chain with ReCom</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#imports">Imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-the-initial-districting-plan">Setting up the initial districting plan</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuring-our-updaters">Configuring our updaters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#instantiating-the-partition">Instantiating the partition</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-the-markov-chain">Setting up the Markov chain</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#proposal">Proposal</a></li>
<li class="toctree-l3"><a class="reference internal" href="#constraints">Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-the-markov-chain">Configuring the Markov chain</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-the-chain">Running the chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-a-plot">Create a plot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="partitions.html">Working with Partitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="updaters.html">Updaters</a></li>
<li class="toctree-l1"><a class="reference internal" href="adjacency.html">Handling Adjacencies</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topics/reproducibility.html">Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/tools.html">Evaluating districting plans in the real world</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/realworldplans.html">Using <code class="docutils literal notranslate"><span class="pre">maup</span></code> to import a real-life plan in GerryChain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/whatislands.html">What to do about islands and connectivity</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #0099cd" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GerryChain</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Running a chain with ReCom</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user/recom.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="running-a-chain-with-recom">
<h1>Running a chain with ReCom<a class="headerlink" href="#running-a-chain-with-recom" title="Permalink to this headline">¶</a></h1>
<p>This document shows how to run a chain using the ReCom proposal used in MGGG’s
<a class="reference external" href="https://mggg.org/VA-report.pdf">2018 Virginia House of Delegates</a> report.</p>
<p>Our goal is to use ReCom to generate an ensemble of districting plans for Pennsylvania,
and then make a box plot comparing the Democratic vote shares for plans in our ensemble
to the 2011 districting plan that the Pennsylvania Supreme Court found to be a
Republican-favoring partisan gerrymander.</p>
<p>This code is also available <a class="reference external" href="https://nbviewer.jupyter.org/github/mggg/gerrychain/tree/main/docs/notebooks/ReCom.ipynb">as a Jupyter notebook</a>.</p>
<p>You can run this example in an interactive Jupyter Notebook session in your
browser, without installing anything, using Binder:</p>
<a class="reference external image-reference" href="https://gke.mybinder.org/v2/gh/mggg/gerrychain/main?filepath=docs/notebooks/ReCom.ipynb"><img alt="https://img.shields.io/badge/launch-binder-579ACA.svg?logo=data:image/png;base64,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" src="https://img.shields.io/badge/launch-binder-579ACA.svg?logo=data:image/png;base64,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" /></a>
<div class="section" id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h2>
<p>The first step is to import everything we’ll need:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">gerrychain</span> <span class="kn">import</span> <span class="p">(</span><span class="n">GeographicPartition</span><span class="p">,</span> <span class="n">Partition</span><span class="p">,</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">MarkovChain</span><span class="p">,</span>
                        <span class="n">proposals</span><span class="p">,</span> <span class="n">updaters</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">accept</span><span class="p">,</span> <span class="n">Election</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">gerrychain.proposals</span> <span class="kn">import</span> <span class="n">recom</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">pandas</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-up-the-initial-districting-plan">
<h2>Setting up the initial districting plan<a class="headerlink" href="#setting-up-the-initial-districting-plan" title="Permalink to this headline">¶</a></h2>
<p>We’ll create our graph using the Pennsylvania shapefile from MGGG-States (download the .json <a class="reference external" href="https://github.com/mggg/GerryChain/blob/main/docs/user/PA_VTDs.json">here</a> if you didn’t start with the Getting started with GerryChain guide):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="s2">&quot;./PA_VTDs.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We configure <code class="xref py py-class docutils literal notranslate"><span class="pre">Election</span></code> objects representing some of the election
data from our shapefile.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">elections</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">Election</span><span class="p">(</span><span class="s2">&quot;SEN10&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Democratic&quot;</span><span class="p">:</span> <span class="s2">&quot;SEN10D&quot;</span><span class="p">,</span> <span class="s2">&quot;Republican&quot;</span><span class="p">:</span> <span class="s2">&quot;SEN10R&quot;</span><span class="p">}),</span>
    <span class="n">Election</span><span class="p">(</span><span class="s2">&quot;SEN12&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Democratic&quot;</span><span class="p">:</span> <span class="s2">&quot;USS12D&quot;</span><span class="p">,</span> <span class="s2">&quot;Republican&quot;</span><span class="p">:</span> <span class="s2">&quot;USS12R&quot;</span><span class="p">}),</span>
    <span class="n">Election</span><span class="p">(</span><span class="s2">&quot;SEN16&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Democratic&quot;</span><span class="p">:</span> <span class="s2">&quot;T16SEND&quot;</span><span class="p">,</span> <span class="s2">&quot;Republican&quot;</span><span class="p">:</span> <span class="s2">&quot;T16SENR&quot;</span><span class="p">}),</span>
    <span class="n">Election</span><span class="p">(</span><span class="s2">&quot;PRES12&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Democratic&quot;</span><span class="p">:</span> <span class="s2">&quot;PRES12D&quot;</span><span class="p">,</span> <span class="s2">&quot;Republican&quot;</span><span class="p">:</span> <span class="s2">&quot;PRES12R&quot;</span><span class="p">}),</span>
    <span class="n">Election</span><span class="p">(</span><span class="s2">&quot;PRES16&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Democratic&quot;</span><span class="p">:</span> <span class="s2">&quot;T16PRESD&quot;</span><span class="p">,</span> <span class="s2">&quot;Republican&quot;</span><span class="p">:</span> <span class="s2">&quot;T16PRESR&quot;</span><span class="p">})</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="configuring-our-updaters">
<h3>Configuring our updaters<a class="headerlink" href="#configuring-our-updaters" title="Permalink to this headline">¶</a></h3>
<p>We want to set up updaters for everything we want to compute for each plan in the ensemble.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Population updater, for computing how close to equality the district</span>
<span class="c1"># populations are. &quot;TOTPOP&quot; is the population column from our shapefile.</span>
<span class="n">my_updaters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;population&quot;</span><span class="p">:</span> <span class="n">updaters</span><span class="o">.</span><span class="n">Tally</span><span class="p">(</span><span class="s2">&quot;TOTPOP&quot;</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;population&quot;</span><span class="p">)}</span>

<span class="c1"># Election updaters, for computing election results using the vote totals</span>
<span class="c1"># from our shapefile.</span>
<span class="n">election_updaters</span> <span class="o">=</span> <span class="p">{</span><span class="n">election</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">election</span> <span class="k">for</span> <span class="n">election</span> <span class="ow">in</span> <span class="n">elections</span><span class="p">}</span>
<span class="n">my_updaters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">election_updaters</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="instantiating-the-partition">
<h3>Instantiating the partition<a class="headerlink" href="#instantiating-the-partition" title="Permalink to this headline">¶</a></h3>
<p>We can now instantiate the initial state of our Markov chain, using the 2011 districting plan:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">initial_partition</span> <span class="o">=</span> <span class="n">GeographicPartition</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">assignment</span><span class="o">=</span><span class="s2">&quot;CD_2011&quot;</span><span class="p">,</span> <span class="n">updaters</span><span class="o">=</span><span class="n">my_updaters</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">GeographicPartition</span></code> comes with built-in <code class="docutils literal notranslate"><span class="pre">area</span></code> and <code class="docutils literal notranslate"><span class="pre">perimeter</span></code> updaters.
We do not use them here, but they would allow us to compute compactness scores like Polsby-Popper
that depend on these measurements.</p>
</div>
</div>
<div class="section" id="setting-up-the-markov-chain">
<h2>Setting up the Markov chain<a class="headerlink" href="#setting-up-the-markov-chain" title="Permalink to this headline">¶</a></h2>
<div class="section" id="proposal">
<h3>Proposal<a class="headerlink" href="#proposal" title="Permalink to this headline">¶</a></h3>
<p>First we’ll set up the ReCom proposal. We need to fix some parameters using <cite>functools.partial</cite>
before we can use it as our proposal function.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># The ReCom proposal needs to know the ideal population for the districts so that</span>
<span class="c1"># we can improve speed by bailing early on unbalanced partitions.</span>

<span class="n">ideal_population</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">initial_partition</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_partition</span><span class="p">)</span>

<span class="c1"># We use functools.partial to bind the extra parameters (pop_col, pop_target, epsilon, node_repeats)</span>
<span class="c1"># of the recom proposal.</span>
<span class="n">proposal</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">recom</span><span class="p">,</span>
                   <span class="n">pop_col</span><span class="o">=</span><span class="s2">&quot;TOTPOP&quot;</span><span class="p">,</span>
                   <span class="n">pop_target</span><span class="o">=</span><span class="n">ideal_population</span><span class="p">,</span>
                   <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
                   <span class="n">node_repeats</span><span class="o">=</span><span class="mi">2</span>
                  <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="constraints">
<h3>Constraints<a class="headerlink" href="#constraints" title="Permalink to this headline">¶</a></h3>
<p>To keep districts about as compact as the original plan, we bound the number
of cut edges at 2 times the number of cut edges in the initial plan.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compactness_bound</span> <span class="o">=</span> <span class="n">constraints</span><span class="o">.</span><span class="n">UpperBound</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;cut_edges&quot;</span><span class="p">]),</span>
    <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">initial_partition</span><span class="p">[</span><span class="s2">&quot;cut_edges&quot;</span><span class="p">])</span>
<span class="p">)</span>

<span class="n">pop_constraint</span> <span class="o">=</span> <span class="n">constraints</span><span class="o">.</span><span class="n">within_percent_of_ideal_population</span><span class="p">(</span><span class="n">initial_partition</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-the-markov-chain">
<h3>Configuring the Markov chain<a class="headerlink" href="#configuring-the-markov-chain" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">chain</span> <span class="o">=</span> <span class="n">MarkovChain</span><span class="p">(</span>
    <span class="n">proposal</span><span class="o">=</span><span class="n">proposal</span><span class="p">,</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">[</span>
        <span class="n">pop_constraint</span><span class="p">,</span>
        <span class="n">compactness_bound</span>
    <span class="p">],</span>
    <span class="n">accept</span><span class="o">=</span><span class="n">accept</span><span class="o">.</span><span class="n">always_accept</span><span class="p">,</span>
    <span class="n">initial_state</span><span class="o">=</span><span class="n">initial_partition</span><span class="p">,</span>
    <span class="n">total_steps</span><span class="o">=</span><span class="mi">1000</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="running-the-chain">
<h2>Running the chain<a class="headerlink" href="#running-the-chain" title="Permalink to this headline">¶</a></h2>
<p>Now we’ll run the chain, putting the sorted Democratic vote percentages directly
into a <code class="xref py py-mod docutils literal notranslate"><span class="pre">pandas</span></code> <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code> for analysis and plotting. The <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>
will have a row for each state of the chain. The first column of the <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> will
hold the lowest Democratic vote share among the districts in each partition in the chain, the
second column will hold the second-lowest Democratic vote shares, and so on.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will take about 10 minutes.</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="nb">sorted</span><span class="p">(</span><span class="n">partition</span><span class="p">[</span><span class="s2">&quot;SEN12&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">percents</span><span class="p">(</span><span class="s2">&quot;Democratic&quot;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">chain</span>
<span class="p">)</span>
</pre></div>
</div>
<p>If you install the <code class="docutils literal notranslate"><span class="pre">tqdm</span></code> package, you can see a progress bar
as the chain runs by running this code instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="nb">sorted</span><span class="p">(</span><span class="n">partition</span><span class="p">[</span><span class="s2">&quot;SEN12&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">percents</span><span class="p">(</span><span class="s2">&quot;Democratic&quot;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">chain</span><span class="o">.</span><span class="n">with_progress_bar</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-plot">
<h2>Create a plot<a class="headerlink" href="#create-a-plot" title="Permalink to this headline">¶</a></h2>
<p>Now we’ll create a box plot similar to those appearing the Virginia report.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Draw 50% line</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#cccccc&quot;</span><span class="p">)</span>

<span class="c1"># Draw boxplot</span>
<span class="n">data</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>

<span class="c1"># Draw initial plan&#39;s Democratic vote %s (.iloc[0] gives the first row)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span>

<span class="c1"># Annotate</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Comparing the 2011 plan to an ensemble&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Democratic vote % (Senate 2012)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Sorted districts&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/recom_plot.svg" src="../_images/recom_plot.svg" /><p>There you go! To build on this, here are some possible next steps:</p>
<ul class="simple">
<li><p>Add, remove, or tweak the constraints</p></li>
<li><p>Use a different proposal from GerryChain, or create your own</p></li>
<li><p>Perform a similar analysis on a different districting plan for Pennsylvania</p></li>
<li><p>Perform a similar analysis on a different state</p></li>
<li><p>Compute partisan symmetry scores like Efficiency Gap or Mean-Median, and
create a histogram of the scores of the ensemble.</p></li>
<li><p>Perform the same analysis using a different election than the 2012 Senate election</p></li>
<li><p>Collect Democratic vote percentages for <em>all</em> the elections we set up, instead
of just the 2012 Senate election.</p></li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Getting started with GerryChain" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="partitions.html" class="btn btn-neutral float-right" title="Working with Partitions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Metric Geometry and Gerrymandering Group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>