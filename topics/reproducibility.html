<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reproducibility &mdash; GerryChain  documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Evaluating districting plans in the real world" href="tools.html" />
    <link rel="prev" title="API Reference" href="../api.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #0099cd" >
            <a href="../index.html" class="icon icon-home"> GerryChain
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/intro.html">Overview of the Chain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/quickstart.html">Getting started with GerryChain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/recom.html">Running a chain with ReCom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/partitions.html">Working with Partitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/updaters.html">Updaters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/data.html">Good Data Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/geometries.html">Working With Geometries</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Reproducibility</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#share-your-code-on-github">Share your code on GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="#make-your-chains-speedily-replayable">Make your chains speedily replayable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-the-same-versions-of-all-of-your-dependencies">Use the same versions of all of your dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#making-your-environment-reproducible">Making Your Environment Reproducible</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Evaluating districting plans in the real world</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to GerryChain</a></li>
</ul>
<p class="caption"><span class="caption-text">Index</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../full_ref.html">Full Package Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #0099cd" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GerryChain</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Reproducibility</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/topics/reproducibility.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="reproducibility">
<h1>Reproducibility<a class="headerlink" href="#reproducibility" title="Permalink to this headline">¶</a></h1>
<p>If you’ve used GerryChain to do some analysis or research, you may want to ensure that
your analysis is completely repeatable by anyone else on their own computer. This guide
will walk you through the steps required to make that possible.</p>
<div class="section" id="share-your-code-on-github">
<h2>Share your code on GitHub<a class="headerlink" href="#share-your-code-on-github" title="Permalink to this headline">¶</a></h2>
<p>Before anyone can run your code, they’ll need to find it. We strongly recommend
publishing your source code as a <a class="reference external" href="https://github.com/">GitHub</a> repository, and not as a <code class="docutils literal notranslate"><span class="pre">.zip</span></code> file on
your personal website. GitHub has a <a class="reference external" href="https://desktop.github.com/">desktop client</a> that makes this easy, or you
can easily upload and edit your files on the website directly.</p>
</div>
<div class="section" id="make-your-chains-speedily-replayable">
<h2>Make your chains speedily replayable<a class="headerlink" href="#make-your-chains-speedily-replayable" title="Permalink to this headline">¶</a></h2>
<p>It is sometimes desirable to allow others to reproduce or “replay” your chain runs step
by step. In such cirucmstances, we recommend using <a class="reference external" href="https://github.com/mggg/pcompress">pcompress</a> which efficiently and
rapidly stores your MCMC chain runs in a highly-compressed format. It can then be
quickly read-in by <cite>pcompress</cite> at a later date. To setup <a class="reference external" href="https://github.com/mggg/pcompress">pcompress</a>, you need to first
<a class="reference external" href="https://doc.rust-lang.org/cargo/getting-started/installation.html">install Cargo</a>. Then, you can install <a class="reference external" href="https://github.com/mggg/pcompress">pcompress</a> by installing running <code class="docutils literal notranslate"><span class="pre">cargo</span>
<span class="pre">install</span> <span class="pre">pcompress</span></code> and <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pcompress</span></code> in your terminal.</p>
<p>To use <a class="reference external" href="https://github.com/mggg/pcompress">pcompress</a>, you can wrap your <code class="docutils literal notranslate"><span class="pre">MarkovChain</span></code> instances with <code class="docutils literal notranslate"><span class="pre">Record</span></code> and
pass along the file name you want to save your chain as. For example, this will save
your chain run as <code class="docutils literal notranslate"><span class="pre">saved-run.chain</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gerrychain</span> <span class="kn">import</span> <span class="n">MarkovChain</span>
<span class="kn">from</span> <span class="nn">pcompress</span> <span class="kn">import</span> <span class="n">Record</span>

<span class="n">chain</span> <span class="o">=</span> <span class="n">MarkovChain</span><span class="p">(</span>
    <span class="c1"># chain setup here</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">Record</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="s2">&quot;saved-run.chain&quot;</span><span class="p">):</span>
    <span class="c1"># normal chain stuff here</span>
</pre></div>
</div>
<p>Then, if you want to replay your chain run, you can select the same filename and pass
along the graph that was used to generate the chain, along with any updaters that are needed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pcompress</span> <span class="kn">import</span> <span class="n">Replay</span>

<span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">Replay</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s2">&quot;saved-run.chain&quot;</span><span class="p">,</span> <span class="n">updaters</span><span class="o">=</span><span class="n">my_updaters</span><span class="p">):</span>
    <span class="c1"># normal chain stuff here</span>
</pre></div>
</div>
<p>The two code samples provided will produce totally equivalent chain runs, up to
reordering. Each step in the replayed chain run will match each step in the recorded
chain run. Furthermore, the replay process will be faster than the original chain
running process and is compatible across future and past releases of GerryChain.</p>
</div>
<div class="section" id="use-the-same-versions-of-all-of-your-dependencies">
<h2>Use the same versions of all of your dependencies<a class="headerlink" href="#use-the-same-versions-of-all-of-your-dependencies" title="Permalink to this headline">¶</a></h2>
<p>You will want to make sure that anyone who tries to repeat your analysis by
running your code will have the exact same versions of all of the software and packages
that you use, including the same version of Python.</p>
<p>The easiest way to do this is to use <a class="reference external" href="https://conda.io/projects/conda/en/latest/index.html">conda</a> to manage all of your dependencies.
You can use conda to export an <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code> file that anyone can use to replicate your
environment by running the command <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">environment.yml</span></code>. For instructions on
how to do this, see <a class="reference external" href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#sharing-an-environment">Sharing your environment</a> and <a class="reference external" href="https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#creating-an-environment-from-an-environment-yml-file">Creating an environment from an environment.yml file</a>
in the conda documentation.</p>
<p>If you’ve published your code on GitHub, it is a good idea to include your <code class="docutils literal notranslate"><span class="pre">environment.yml</span></code>
file in the root folder of your code repository.</p>
</div>
<div class="section" id="making-your-environment-reproducible">
<h2>Making Your Environment Reproducible<a class="headerlink" href="#making-your-environment-reproducible" title="Permalink to this headline">¶</a></h2>
<p>If you are working on a project wherein you would like to ensure
particuluar runs are reproducible, it is necessary to invoke</p>
<ul class="simple">
<li><p><strong>MacOS/Linux</strong>: <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PYTHONHASHSEED=0</span></code></p></li>
<li><p><strong>Windows</strong>:</p>
<ul>
<li><p>PowerShell <code class="docutils literal notranslate"><span class="pre">$env:PYTHONHASHSEED=0</span></code></p></li>
<li><p>Command Prompt <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">PYTHONHASHSEED=0</span></code></p></li>
</ul>
</li>
</ul>
<p>before running your code. This will ensure that the hash seed is deterministic
which is important for the replication of spanning trees accross your runs. If you
would prefer to not have to do this every time, then you need to modify the
activation script for the virtual environment. Again, this is different depending
on your operating system:</p>
<ul>
<li><p><strong>MacOS/Linux</strong>: Open the file <code class="docutils literal notranslate"><span class="pre">.venv/bin/activate</span></code> located in your working
directory using your favorite text editor
and add the line <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PYTHONHASHSEED=0</span></code> after the <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PATH</span></code> command.
So you should see something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_OLD_VIRTUAL_PATH</span><span class="o">=</span><span class="s2">&quot;$PATH&quot;</span>
<span class="n">PATH</span><span class="o">=</span><span class="s2">&quot;$VIRTUAL_ENV/Scripts:$PATH&quot;</span>
<span class="n">export</span> <span class="n">PATH</span>

<span class="n">export</span> <span class="n">PYTHONHASHSEED</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<p>Then, verify that the hash seed is set to 0 in your Python environment by
running <code class="docutils literal notranslate"><span class="pre">python</span></code> from the command line and typing
<code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">os;</span> <span class="pre">print(os.environ['PYTHONHASHSEED'])</span></code>.</p>
</li>
<li><p><strong>Windows</strong>: To be safe, you will need to modify 3 files within your virtual
environment:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">.venv\Scripts\activate</span></code>: Add the line <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PYTHONHASHSEED=0</span></code> after
the <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PATH</span></code> command. So you should see something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_OLD_VIRTUAL_PATH</span><span class="o">=</span><span class="s2">&quot;$PATH&quot;</span>
<span class="n">PATH</span><span class="o">=</span><span class="s2">&quot;$VIRTUAL_ENV/Scripts:$PATH&quot;</span>
<span class="n">export</span> <span class="n">PATH</span>

<span class="n">export</span> <span class="n">PYTHONHASHSEED</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">.venv\Scripts\activate.bat</span></code>: Add the line <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">PYTHONHASHSEED=0</span></code> to the
end of the file. So you should see something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">defined</span> <span class="n">_OLD_VIRTUAL_PATH</span> <span class="nb">set</span> <span class="n">PATH</span><span class="o">=%</span><span class="n">_OLD_VIRTUAL_PATH</span><span class="o">%</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">defined</span> <span class="n">_OLD_VIRTUAL_PATH</span> <span class="nb">set</span> <span class="n">_OLD_VIRTUAL_PATH</span><span class="o">=%</span><span class="n">PATH</span><span class="o">%</span>

<span class="nb">set</span> <span class="n">PATH</span><span class="o">=%</span><span class="n">VIRTUAL_ENV</span><span class="o">%</span>\<span class="n">Scripts</span><span class="p">;</span><span class="o">%</span><span class="n">PATH</span><span class="o">%</span>
<span class="n">rem</span> <span class="nb">set</span> <span class="n">VIRTUAL_ENV_PROMPT</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="n">venv</span><span class="p">)</span>
<span class="nb">set</span> <span class="n">PYTHONHASHSEED</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">.venv\Scripts\Activate.ps1</span></code>: Add the line <code class="docutils literal notranslate"><span class="pre">$env:PYTHONHASHSEED=0</span></code> to the
end of the before the signature bolck. So you should see something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Add the venv to the PATH
Copy-Item -Path Env:PATH -Destination Env:_OLD_VIRTUAL_PATH
$Env:PATH = &quot;$VenvExecDir$([System.IO.Path]::PathSeparator)$Env:PATH&quot;

$env:PYTHONHASHSEED=0

# SIG # Begin signature block
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<p>After you have made these changes, verify that the hash seed is set to 0 in your
Python environment by running <code class="docutils literal notranslate"><span class="pre">python</span></code> from the command line and typing
<code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">os;</span> <span class="pre">print(os.environ['PYTHONHASHSEED'])</span></code> in the Python prompt.</p>
<div class="note admonition">
<p class="admonition-title">A Note on Jupyter</p>
<p>If you are using a jupyter notebook, you will need to make sure that you have
installed the <code class="docutils literal notranslate"><span class="pre">ipykernel</span></code> package in your virtual environment as well as
either <code class="docutils literal notranslate"><span class="pre">jupyternotebook</span></code> or <code class="docutils literal notranslate"><span class="pre">jupyterlab</span></code>. To install these packages, run
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">&lt;package-name&gt;</span></code> from the command line. Then, to use the virtual
python environment in your jupyter notebook, you need to invoke</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">jupyter notebook</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">jupyter lab</span>
</pre></div>
</div>
<p>from the command line of your working directory <em>while your virtual environment
is activated</em>. This will open a jupyter notebook in your default browser. You may
then check that the hash seed is set to 0 by running the following code in a cell
of your notebook:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PYTHONHASHSEED&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Of course, once this is all done, it would be a good idea to save the random seed
that you used somewhere so that others may replicate your work in the future.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../api.html" class="btn btn-neutral float-left" title="API Reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tools.html" class="btn btn-neutral float-right" title="Evaluating districting plans in the real world" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Metric Geometry and Gerrymandering Group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>